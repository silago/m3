!function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[i]={exports:{}};t[i][0].call(f.exports,function(e){var n=t[i][1][e];return o(n?n:e)},f,f.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(e,n){r(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return a.fall_speed=200,a.parent=jMatch3.Grid,a.types=n.types,a.game=e,a.options=n,a.info=n.info,a.can_move=!0,a.stack=[],a.score=0,a.label=a.game.add.text(a.info.sprites.x*(2+n.width),n.height*a.info.sprites.y/2,"0",{font:"42px Arial",fill:"#ffffff",align:"center"}),a.label.anchor.set(.5),a}return a(t,e),i(t,[{key:"init",value:function(){var e=this;this.movePieces(this.initPieces(),["y"]).then(function(){return e.fallPieces()}).then(function(){alert(e.can_move),e.can_move=!0})}},{key:"updateHud",value:function(){this.label.text=this.score}},{key:"updateScore",value:function(e){e&&(this.score+=e)}},{key:"fallPieces",value:function(){var e=this;return this.can_move=!1,new Promise(function(t,n){var r=!1;if(e.getAxisMatches().forEach(function(t){e.updateScore(t[0].object.score*t.length),r=!0,t.forEach(function(e){e._clear()})}),r){e.updateHud();var o=[].concat(e.applyGravity());e.movePieces(o,["y"]).then(function(){e.movePieces(e.initPieces(),["y"]).then(function(){return e.fallPieces()})})}else e.can_move=!0,t()})}},{key:"swap",value:function(e){var t=this;if(this.can_move&&(this.stack.push(e),2==this.stack.length)){if(Math.abs(this.stack[0].x-this.stack[1].x)+Math.abs(this.stack[0].y-this.stack[1].y)!=1)return void(this.stack=[]);this.swapPieces(this.stack[0],this.stack[1]),this.movePieces(this.stack,["x","y"]).then(function(){return t.fallPieces()}),this.stack=[]}}},{key:"movePieces",value:function(e,t){var n=this,r=[];return e.forEach(function(e){var o=!0,a=!1,i=void 0;try{for(var s,u=t[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value,f={};f[c]=e[c]*n.info.sprites.x,r.push(n.moveOnePiece(e,f))}}catch(e){a=!0,i=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw i}}}),Promise.all(r)}},{key:"moveOnePiece",value:function(e,t){var n=this;return new Promise(function(r,o){var a=n.game.add.tween(e.object.image).to(t,n.fall_speed,Phaser.Easing.Linear.None);a.frameBased=!1,a.onComplete.add(function(){e.object.image.events.onInputDown.removeAll(),e.object.image.events.onInputDown.add(function(){n.swap(e)},n),r()}),a.start()})}},{key:"initPieces",value:function(){var e=this,t=[];return this.forEachPiece(function(n){if("empty"==n.object.type){t.push(n);var r=Math.floor(Math.random()*e.types.length);n._clear=function(){"undefined"!=typeof this.object.image&&(this.object.image.destroy(),this.object.image=null),this.clear()},n.object={type:r,score:e.types[r].score,image:e.game.add.sprite(n.x*e.info.sprites.x,(-1+n.y-e.options.width)*e.info.sprites.y,e.types[r].texture,e.types[r].frame)},n.object.image.inputEnabled=!0,n.object.image.events.onInputDown.removeAll(),n.object.image.events.onInputDown.add(function(){e.swap(n)},e)}}),t}},{key:"getAxisMatches",value:function(e){for(var t=this.parent.directions,n={x:{up:{x:0,y:-1},down:{x:0,y:1}},y:{right:{x:1,y:0},left:{x:-1,y:0}}},r=[],o=["x","y"],a=0;a<o.length;a++){var i=o[a];this.parent.directions=n[i];var s=this.getMatches();this.parent.directions=t,s&&(r=[].concat(r,s))}return r}}]),t}(jMatch3.Grid);n.default=s},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var o=e("./states/boot"),a=r(o),i=e("./states/game"),s=r(i),u=e("./states/menu"),c=r(u),f=e("./states/preloader"),l=r(f),h=e("./states/gameover"),p=r(h),y=new Phaser.Game(window.innerWidth,window.innerHeight,Phaser.AUTO,"match3-game");y.state.add("boot",new a.default),y.state.add("game",new s.default),y.state.add("menu",new c.default),y.state.add("preloader",new l.default),y.state.add("gameover",new p.default),y.state.start("boot")},{"./states/boot":3,"./states/game":4,"./states/gameover":5,"./states/menu":6,"./states/preloader":7}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),i(t,[{key:"preload",value:function(){this.load.image("preloader","assets/preloader.gif"),this.load.spritesheet("gems","assets/gems.png",50,50,3)}},{key:"create",value:function(){this.game.input.maxPointers=1,this.game.device.desktop?this.game.scale.pageAlignHorizontally=!0:(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.minWidth=480,this.game.scale.minHeight=260,this.game.scale.maxWidth=640,this.game.scale.maxHeight=480,this.game.scale.forceOrientation(!0),this.game.scale.pageAlignHorizontally=!0,this.game.scale.setScreenSize(!0)),this.initGlobalVariables(),this.game.state.start("preloader")}},{key:"initGlobalVariables",value:function(){this.game.global={}}}]),t}(Phaser.State);n.default=s},{}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../lib/match3phaser"),c=r(u),f=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return i(t,e),s(t,[{key:"create",value:function(){this.grid=new c.default(this.game,{width:9,height:9,gravity:"down",info:{sprites:{x:50,y:50}},types:[{key:0,texture:"gems",frame:0,score:10},{key:1,texture:"gems",frame:1,score:20},{key:2,texture:"gems",frame:2,score:30}]}),this.grid.init()}}]),t}(Phaser.State);n.default=f},{"../lib/match3phaser":1}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),i(t,[{key:"create",value:function(){var e=this.add.text(.5*this.game.width,.5*this.game.height,"Gameover",{font:"42px Arial",fill:"#ffffff",align:"center"});e.anchor.set(.5),this.saveVarsToLocalStorage(),this.input.onDown.add(this.restartGame,this)}},{key:"saveVarsToLocalStorage",value:function(){}},{key:"resetGlobalVariables",value:function(){}},{key:"update",value:function(){}},{key:"restartGame",value:function(){this.resetGlobalVariables(),this.game.state.start("menu")}}]),t}(Phaser.State);n.default=s},{}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return a(t,e),i(t,[{key:"create",value:function(){var e=this.add.text(.5*this.game.width,.5*this.game.height,"TAP TO START",{font:"42px Arial",fill:"#ffffff",align:"center"});e.anchor.set(.5),this.input.onDown.add(this.startGame,this)}},{key:"update",value:function(){}},{key:"startGame",value:function(){this.game.state.start("game")}}]),t}(Phaser.State);n.default=s},{}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.asset=null,e.ready=!1,e}return a(t,e),i(t,[{key:"preload",value:function(){this.asset=this.add.sprite(.5*this.game.width-110,.5*this.game.height-10,"preloader"),this.load.setPreloadSprite(this.asset)}},{key:"update",value:function(){this.game.state.start("menu")}},{key:"loadResources",value:function(){}},{key:"onLoadComplete",value:function(){this.ready=!0}}]),t}(Phaser.State);n.default=s},{}]},{},[2]);
